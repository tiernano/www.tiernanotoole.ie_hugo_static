<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>AS204994, Own IP Space and Anycast | Tiernan&#39;s Comms Closet</title>
    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="/css/fonts.css" />
    
  </head>

  <body>
    <nav>
    <ul class="menu">
      
    </ul>
    <hr/>
    </nav>

<div class="article-meta">
<h1><span class="title">AS204994, Own IP Space and Anycast</span></h1>

<h2 class="date">2018/04/01</h2>
</div>

<main>
<p>So, if you are reading this page, it is being delivered with the magic of Anycast&hellip; Well, technically, it was before, since i used <a href="http://cloudflare.com">Cloudflare</a>, and it still is because of Cloudflare, but also because of my own ASN (<a href="http://as204994.net">As204994</a>), some servers in different locations, and some magic, which i will explain a bit of in this post.</p>

<p>This all started late last year when i got my hands on an ASN and a /48 block of IPv6 addresses. I had been reading stuff about BGP, routing, etc, and decided to go all in. it was quite cheap with the help of <a href="https://my.hostus.us/aff.php?aff=2152">HostUS</a>. All in, it was about $50 for the year. As part of the process, i needed 2 upstream providers to say they would accept my announcement. They were <a href="https://www.he.net">Hurricane Electric</a> though their <a href="http://www.tunnelbroker.com">Tunnel Broker</a> service, and <a href="https://www.vultr.com/?ref=6925432">Vultr </a>using a few of their VPSs.</p>

<p>After i got my space and ASN, i started to announce the V6 addresses over Vultr and Hurricane Electric, and all was good. I had 2 Vultr servers: 1 in London, UK, and one in New Jersey, USA. I had my home machine announce to HE, and then also link to both Vultr servers using <a href="https://www.zerotier.com">Zerotier</a>. All worked well, but due to some family issues, i never got around to putting it into production&hellip; till now.</p>

<p>Those 3 servers now share an IPv6 address on the loopback port. When you (well, Cloudflare) asks for that IP, the closet (network) with that IP responds, and the NGinx server on that box sends back the contents of the site. This site is hosted on each box, since its fully static, but both <a href="https://as204994.net">AS204994 </a>and <a href="https://tiernanotoole.net">TiernanOToole.net</a> are hosted in Ghost, so Dublin (my machine in the house) serves them, and both Lon1 and Nyc1 do proxying. so, most requests from the US are hitting the box in NYC and the ones in Europe share either Dub1 or Lon1. I have some tweaks to do with which servers will be running where, and may add more, but currently its working well.</p>

<p>So, how do you figure out what server responded? Simple. Open your Dev tools on your browser, go to network tab, refresh, and see the response headers for anything on this domain. You should see something like below.</p>


<a href="https://res.cloudinary.com/tiernanotoole/image/upload/q_auto,f_auto//v1530702268/responding-server.png"><img src="https://res.cloudinary.com/tiernanotoole/image/upload/w_500,q_auto,f_auto//v1530702268/responding-server.png" alt=""></a>



<p>Over the next while, i will be updating tiernanotoole.net with more details on how this works, and more stuff will end up on AS204994.net too. If anyone notices any weird and wonderful issues, shout. If you have more questions, shout.</p>

</main>

  <footer>
  
  
  </footer>
  </body>
</html>

